#include <iostream>
#include <cmath>
#include <functional>
#include <vestor>
#include <iomanip>
#include <fstream>
#include <string>
using namespace std;

using Func = function<double(double)>;

struct TestFunction {
   string name;
   Func F;
   Func f1_exact;
   Func f2_exact;
};
// -------- 1st derivatives --------
double forward_diff(Func f, double x, double h){ return (f(x+h)-f(x))/h; }
double backward_diff(Func f, double x, double h){ return (f(x)-f(x-h))/h; }
double central_diff(Func f, double x, double h){ return (f(x+h)-f(x-h))/(2*h); }
// -------- 2nd derivatives --------
double forward_diff2(Func f, double x, double h){
    return (f(x+2*h) - 2*f(x+h) + f(x)) / (h*h);
}
double backward_diff2(Func f, double x, double h){
    return (f(x) - 2*f(x-h) + f(x-2*h)) / (h*h);
}
double central_diff2(Func f, double x, double h){
    return (f(x+h) - 2*f(x) + f(x-h)) / (h*h);
}
//member-4
int main(){


   vector<TestFunction> funcs = {
       {"f(x) = sin(x)",
           [](double x){ return sin(x); },
           [](double x){ return cos(x); },
           [](double x){ return -sin(x); }
       },


       {"f(x) = e^x",
           [](double x){ return exp(x); },
           [](double x){ return exp(x); },
           [](double x){ return exp(x); }
       },
       {"f(x) = x^3",
           [](double x){ return x*x*x; },
           [](double x){ return 3*x*x; },
           [](double x){ return 6*x; }
       }
   };
//member-5
   cout << "\n========================================\n";
   cout << "        NUMERICAL DIFFERENTIATION       \n";
   cout << "========================================\n\n";


   cout << "Choose function:\n";
   for(size_t i=0;i<funcs.size();i++)
       cout << " " << i+1 << ". " << funcs[i].name << "\n";


   int choice;
   while(true){
       cout << "\nEnter choice (1-" << funcs.size() << "): ";
       cin >> choice;
       if(choice>=1 && choice<= (int)funcs.size()) break;
       cout << "Invalid choice! Please enter a valid number.\n";

//last part
cout << setw(12) << setprecision(3) << fixed << h << setprecision(8)
             << setw(14) << fwd
             << setw(14) << bwd
             << setw(14) << cen
             << setw(14) << exact
             << setw(16) << fabs(exact-cen)
             << "\n";

        csv2 << h << "," << fabs(exact-fwd) << ","
                  << fabs(exact-bwd) << ","
                  << fabs(exact-cen) << "\n";
    }

    csv1.close();
    csv2.close();

    return 0;
}
